{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block styles %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/search.css') }}">
{% endblock %}

{% block content %}
{% from "macros.html" import input, render_pagination, flashed_message with context %}

<p class="form-title">Search</p>
<div>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {{ flashed_message(messages) }}
    {% endwith %}
</div>
<form action="" method="get" id=query_form>
    {{ input(form.query) }}
</form>
<table class="table table-sm">
    <thead>
        <th scope="col">Title</th>
        <th scope="col" class="author-column">Author</th>
        <th scope="col">Publication year</th>
        <th></th>
    </thead>
    {% if all_query|length == 0 %}
    <tr>No result found!</tr>
    {% else %}
    <tbody>
        {% for item in all_query %}
        <tr>
            <td>
                <a href="{{ url_for('library.item_description', item_id=item['id']) }}">
                    <p class="title-paragraph" title="{{ item['title'] }}">
                        {{ item['title'] }}
                    </p>
                    
                </a>
            </td>
            <td>
                {% if item['type'] == 'book' %}
                <ul class="author-list author-paragraph" title="{{ ', '.join(item['authors']) }}">
                    {% for author in item['authors'] %}
                    <li class="author-list-item">{{author}}</li>
                    {% endfor %}
                </ul>
                {% elif item['type'] == 'magazine' %}
                <p class="author-paragraph">Issue no.: {{ item['issue'] }}</p>
                {% endif %}
            </td>
            <td>
                {{item['pub_date'].year}}
            </td>
            <td style="width: 10px;">
                {% if item['type'] == 'book' %}
                <img src="../../static/img/i_book.png" alt='book' />{% endif %}
                {% if item['type'] == 'magazine' %}
                <img src="../../static/img/i_newspaper.png" alt='journal' />{% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<nav aria-label="Page navigation search">
    {{ render_pagination(pagination, endpoint, query_str=query_str) }}
</nav>
{% endif %}

{% endblock %}